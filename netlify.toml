# Netlify Deploy Configuration
#
# This site is the Astro-based frontend only.
# The cis118m-dotnet-runner backend should be deployed separately.
#
# Proxy configuration: Editor calls /api/* which routes to Netlify Function
# that forwards to the deployed runner with authentication.

[build]
  command = "npm run build"
  publish = "dist"

[dev]
  command = "npm run dev"
  targetPort = 4321
  port = 8888

# Netlify Functions configuration
[functions]
  directory = "netlify/functions"
  node_bundler = "esbuild"

# Route /api/redis-ping to the redis-ping function
[[redirects]]
  from = "/api/redis-ping"
  to = "/.netlify/functions/redis-ping"
  status = 200
  force = true

# Route /api/code-get to the code-get function
[[redirects]]
  from = "/api/code-get"
  to = "/.netlify/functions/code-get"
  status = 200
  force = true

# Route /api/code-save to the code-save function
[[redirects]]
  from = "/api/code-save"
  to = "/.netlify/functions/code-save"
  status = 200
  force = true

# Route /api/progress-get to the progress-get function
[[redirects]]
  from = "/api/progress-get"
  to = "/.netlify/functions/progress-get"
  status = 200
  force = true

# Route /api/progress-update to the progress-update function
[[redirects]]
  from = "/api/progress-update"
  to = "/.netlify/functions/progress-update"
  status = 200
  force = true

# Route /api/* to the runner-proxy function (catch-all)
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/runner-proxy"
  status = 200
  force = true

# Environment variables needed in Netlify dashboard:
# - RUNNER_URL: https://cis118m-dotnet-course-site-astro.onrender.com
# - RUNNER_KEY: A secret key that the runner will validate
# - Do NOT set PUBLIC_RUNNER_URL (leave empty)

