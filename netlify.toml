# Netlify Deploy Configuration
#
# This site is the Astro-based frontend only.
# The cis118m-dotnet-runner backend should be deployed separately.
#
# Proxy configuration: When PUBLIC_RUNNER_URL is unset, the editor
# calls same-origin paths (/compile, /run, /check) which Netlify
# proxies to the deployed runner.

[build]
  command = "npm run build"
  publish = "dist"

[dev]
  command = "npm run dev"
  targetPort = 4321
  port = 8888

# Explicitly set functions directory to avoid auto-detection
[functions]
  directory = "netlify/functions"

# Proxy API requests to the deployed .NET runner on Render
[[redirects]]
  from = "/health"
  to = "https://cis118m-dotnet-course-site-astro.onrender.com/health"
  status = 200
  force = true

[[redirects]]
  from = "/compile"
  to = "https://cis118m-dotnet-course-site-astro.onrender.com/compile"
  status = 200
  force = true

[[redirects]]
  from = "/run"
  to = "https://cis118m-dotnet-course-site-astro.onrender.com/run"
  status = 200
  force = true

[[redirects]]
  from = "/check"
  to = "https://cis118m-dotnet-course-site-astro.onrender.com/check"
  status = 200
  force = true

# Environment variables:
# - Do NOT set PUBLIC_RUNNER_URL in Netlify (leave empty for proxy approach)
# - Set ALLOWED_ORIGINS on the runner to include your Netlify domain

