---
interface Props {
  starterId: string;
  week?: string;
}

const { starterId, week } = Astro.props;
const weekParam = week ? `&week=${week}` : '';
const editorUrl = `/editor/?starter=${starterId}${weekParam}`;
---

<div class="editor-button-wrapper" data-starter={starterId}>
  <a href={editorUrl} class="button editor-cta" data-status="not-started">
    <span class="cta-text">Open Code Editor</span>
    <span class="cta-status"></span>
  </a>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const PROGRESS_KEY = "cis118m:progress";
    
    const getProgress = () => {
      try {
        const data = localStorage.getItem(PROGRESS_KEY);
        return data ? JSON.parse(data) : {};
      } catch {
        return {};
      }
    };
    
    const updateEditorButtons = () => {
      const wrappers = document.querySelectorAll('.editor-button-wrapper');
      
      wrappers.forEach(wrapper => {
        const starterId = wrapper.getAttribute('data-starter');
        const button = wrapper.querySelector('.editor-cta');
        const textSpan = button.querySelector('.cta-text');
        const statusSpan = button.querySelector('.cta-status');
        
        if (!starterId || !button) return;
        
        const progress = getProgress();
        const status = progress[starterId] || 'not-started';
        
        button.setAttribute('data-status', status);
        
        if (status === 'completed') {
          textSpan.textContent = 'Review';
          statusSpan.textContent = ' âœ“ Completed';
        } else if (status === 'in-progress') {
          textSpan.textContent = 'Continue';
          statusSpan.textContent = '';
        } else {
          textSpan.textContent = 'Open Code Editor';
          statusSpan.textContent = '';
        }
      });
    };
    
    updateEditorButtons();
    
    // Update when progress changes
    window.addEventListener('progressUpdated', updateEditorButtons);
  });
</script>

<style>
  .editor-button-wrapper {
    margin-top: 16px;
    display: inline-block;
  }
  
  .editor-cta {
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  
  .editor-cta[data-status="completed"] {
    background: rgba(34, 197, 94, 0.15);
    border-color: rgba(34, 197, 94, 0.4);
    color: #22c55e;
  }
  
  .editor-cta[data-status="completed"]:hover {
    background: rgba(34, 197, 94, 0.25);
  }
  
  .editor-cta[data-status="in-progress"] {
    background: rgba(59, 130, 246, 0.15);
    border-color: rgba(59, 130, 246, 0.4);
  }
  
  .cta-status {
    font-size: 14px;
    font-weight: 600;
  }
</style>
