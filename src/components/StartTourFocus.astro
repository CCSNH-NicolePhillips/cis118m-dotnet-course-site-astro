---
---
<div id="start-tour-focus-overlay" class="focus-overlay">
  <div class="arrow-container">
    <span class="bouncing-arrow">⬇️</span>
  </div>
</div>

<style>
  .focus-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
    z-index: 9998; /* Just under the tour overlay */
    display: flex;
    justify-content: center;
    align-items: center;
    pointer-events: none; /* Let clicks pass through to the button */
  }
  .arrow-container {
    position: fixed;
    /* Position will be set by JS to be above the button */
    transform: translate(-50%, 0); /* Center horizontally */
    z-index: 9999;
  }
  .bouncing-arrow {
    font-size: 3rem;
    display: block;
    animation: bounce 1s infinite alternate;
  }
  @keyframes bounce {
    from { transform: translateY(0); }
    to { transform: translateY(-20px); }
  }
  /* This class will be added to the button itself */
  :global(.pulsing-glow) {
    position: relative;
    z-index: 9999; /* Bring button above the overlay */
    box-shadow: 0 0 0 0 rgba(236, 72, 153, 0.7);
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(236, 72, 153, 0.7); }
    70% { box-shadow: 0 0 0 15px rgba(236, 72, 153, 0); }
    100% { box-shadow: 0 0 0 0 rgba(236, 72, 153, 0); }
  }
</style>

<script>
  (function() {
  // Use the same key format as LabTour
  const tourKey = 'cis118m:lab-tour-completed:' + window.location.pathname;
  const tourCompleted = localStorage.getItem(tourKey);
  
  // Find the elements
  const overlay = document.getElementById('start-tour-focus-overlay');
  const arrowContainer = overlay?.querySelector('.arrow-container');
  const startButton = document.getElementById('start-lab-tour-btn');
  
  // Helper to hide the focus overlay
  function hideFocusOverlay() {
    if (overlay) overlay.style.display = 'none';
    if (startButton) startButton.classList.remove('pulsing-glow');
  }
  
  // Only show focus overlay if tour hasn't been completed
  if (tourCompleted) {
    // User already did the tour - hide the focus overlay
    hideFocusOverlay();
  } else if (startButton && overlay && arrowContainer) {
    // First time - show the focus overlay
    
    // Function to update arrow position
    function updateArrowPosition() {
      const rect = startButton.getBoundingClientRect();
      arrowContainer.style.top = `${rect.top - 70}px`;
      arrowContainer.style.left = `${rect.left + rect.width / 2}px`;
    }
    
    // 1. Initial position
    updateArrowPosition();
    
    // 2. Update on scroll and resize to keep arrow locked to button
    window.addEventListener('scroll', updateArrowPosition);
    window.addEventListener('resize', updateArrowPosition);
    
    // 3. Listen for tour completion (via storage event or custom event)
    window.addEventListener('tourCompleted', hideFocusOverlay);
    
    // Also check for localStorage changes (in case tour ends)
    const checkTourComplete = setInterval(() => {
      if (localStorage.getItem(tourKey)) {
        clearInterval(checkTourComplete);
        hideFocusOverlay();
      }
    }, 500);
    
    // 4. Add the glowing class to the button
    startButton.classList.add('pulsing-glow');
    
    // 5. Hide the effect when the button is clicked
    startButton.addEventListener('click', () => {
      hideFocusOverlay();
      window.removeEventListener('scroll', updateArrowPosition);
      window.removeEventListener('resize', updateArrowPosition);
    });
  }
  })();
</script>
